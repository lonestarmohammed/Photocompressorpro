<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Background Remover ‚Äì PhotoCompressorPro</title>
  <link rel="icon" href="../assets/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../style.css">
  <style>
    main{max-width:960px;margin:34px auto;padding:0 16px}
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 28px rgba(0,0,0,.06);padding:24px}
    .hero{text-align:center;margin-bottom:14px}
    .hero h1{margin:0 0 6px;font-size:1.7rem}
    .hero p{margin:0;color:#6b7280}
    .controls{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:10px 0 14px}
    .btn{appearance:none;border:0;border-radius:12px;cursor:pointer;background:linear-gradient(90deg,#1f6fff,#00c2ff);color:#fff;padding:12px 18px;font-weight:700;box-shadow:0 10px 22px rgba(31,111,255,.22)}
    .btn.secondary{background:#eef2ff;color:#1f3a8a;box-shadow:none}
    .range{width:220px}
    .stage{display:grid;gap:16px;grid-template-columns:1fr;place-items:center;margin-top:12px}
    .canvas-wrap{position:relative;max-width:100%}
    canvas{max-width:100%;background-image:linear-gradient(45deg,#eee 25%, transparent 25%),linear-gradient(-45deg,#eee 25%, transparent 25%),linear-gradient(45deg, transparent 75%, #eee 75%),linear-gradient(-45deg, transparent 75%, #eee 75%);background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0}
    .note{font-size:.9rem;color:#6b7280}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="nav-wrap">
      <a class="brand" href="../index.html">Photo<span class="accent">Compressor</span>Pro</a>
      <nav>
        <a href="../index.html">Home</a>
        <a href="../blog.html">Blog</a>
        <a href="../contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="hero">
        <h1>Background Remover (Click + Tolerance)</h1>
        <p>Click the background color to remove it. Adjust tolerance for near shades. Download as PNG (keeps transparency).</p>
      </div>

      <div class="controls">
        <label class="btn secondary" for="fileInput">üìÅ Choose Image</label>
        <input id="fileInput" type="file" accept="image/*" style="display:none">

        <label>Tolerance:
          <input id="tol" class="range" type="range" min="5" max="120" value="40">
          <span id="tolv">40</span>
        </label>

        <button id="autoPick" class="btn secondary">Auto-pick Corner</button>
        <button id="download" class="btn">Download PNG</button>
      </div>

      <div class="stage">
        <div class="canvas-wrap">
          <canvas id="canvas"></canvas>
        </div>
        <div class="note">Tip: click a background region in the image to remove similar colors. Increase tolerance for uneven backgrounds.</div>
      </div>
    </section>
  </main>

  <footer style="text-align:center;color:#6b7280;margin:30px 0 24px;font-size:.9rem">
    ¬© 2025 PhotoCompressorPro.com ‚Ä¢ <a href="../privacy.html">Privacy</a> ‚Ä¢ <a href="../about.html">About</a> ‚Ä¢ <a href="../contact.html">Contact</a>
  </footer>

  <script>
    const fileInput = document.getElementById('fileInput');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently:true });
    const tol = document.getElementById('tol');
    const tolv = document.getElementById('tolv');
    const autoPick = document.getElementById('autoPick');
    const downloadBtn = document.getElementById('download');

    let imgEl = null;

    tol.addEventListener('input', ()=> tolv.textContent = tol.value);

    function loadImage(file){
      return new Promise((resolve, reject)=>{
        const r = new FileReader();
        r.onload = e => {
          const img = new Image();
          img.onload = ()=> resolve(img);
          img.onerror = reject;
          img.src = e.target.result;
        };
        r.onerror = reject;
        r.readAsDataURL(file);
      });
    }

    function drawImageFit(img){
      const maxW = Math.min(1600, img.width);
      const scale = Math.min(maxW / img.width, 1);
      canvas.width = Math.round(img.width * scale);
      canvas.height = Math.round(img.height * scale);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    }

    fileInput.addEventListener('change', async ()=>{
      const f = fileInput.files?.[0];
      if (!f) return;
      imgEl = await loadImage(f);
      drawImageFit(imgEl);
    });

    function getPixel(x,y){
      const d = ctx.getImageData(x,y,1,1).data;
      return {r:d[0],g:d[1],b:d[2],a:d[3]};
    }
    function colorDist(p,c){
      const dr=p.r-c.r, dg=p.g-c.g, db=p.b-c.b;
      return Math.sqrt(dr*dr + dg*dg + db*db);
    }
    function removeByColor(target, tolerance){
      const w = canvas.width, h = canvas.height;
      const imgData = ctx.getImageData(0,0,w,h);
      const d = imgData.data;
      for (let i=0;i<d.length;i+=4){
        const r=d[i], g=d[i+1], b=d[i+2], a=d[i+3];
        if (a===0) continue;
        if (colorDist({r,g,b}, target) <= tolerance){
          d[i+3] = 0; // transparent
        }
      }
      ctx.putImageData(imgData, 0, 0);
    }

    canvas.addEventListener('click', (e)=>{
      if (!imgEl) return;
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) * (canvas.width/rect.width));
      const y = Math.floor((e.clientY - rect.top)  * (canvas.height/rect.height));
      const picked = getPixel(x,y);
      removeByColor(picked, parseInt(tol.value,10));
    });

    autoPick.addEventListener('click', ()=>{
      if (!imgEl) return;
      // sample 4 corners and remove near colors
      const points = [
        {x:2,y:2},
        {x:canvas.width-3,y:2},
        {x:2,y:canvas.height-3},
        {x:canvas.width-3,y:canvas.height-3},
      ];
      const t = parseInt(tol.value,10);
      points.forEach(p=>{
        const picked = getPixel(p.x,p.y);
        removeByColor(picked, t);
      });
    });

    downloadBtn.addEventListener('click', ()=>{
      if (!canvas.width || !canvas.height) { alert('Please choose an image first.'); return; }
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url; a.download = 'bg-removed.png';
      a.click();
    });
  </script>
</body>
</html>
