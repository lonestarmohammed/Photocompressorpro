<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Image to PDF ‚Äì PhotoCompressorPro</title>
  <link rel="icon" href="../assets/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../style.css">
  <style>
    main{max-width:960px;margin:34px auto;padding:0 16px}
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 28px rgba(0,0,0,.06);padding:24px}
    .hero{text-align:center;margin-bottom:14px}
    .hero h1{margin:0 0 6px;font-size:1.7rem}
    .hero p{margin:0;color:#6b7280}
    .controls{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:10px 0 14px}
    .btn{appearance:none;border:0;border-radius:12px;cursor:pointer;background:linear-gradient(90deg,#1f6fff,#00c2ff);color:#fff;padding:12px 18px;font-weight:700;box-shadow:0 10px 22px rgba(31,111,255,.22)}
    .btn.secondary{background:#eef2ff;color:#1f3a8a;box-shadow:none}
    select, input[type="number"]{padding:10px 12px;border:1px solid #d1d5db;border-radius:10px}
    .preview{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));margin-top:12px}
    .thumb{border:1px solid rgba(15,23,42,.08);border-radius:12px;padding:8px;background:#fff;text-align:center}
    .thumb img{max-width:100%;border-radius:8px}
    .meta{font-size:.85rem;color:#6b7280;margin-top:6px}
    /* make input clickable even if label fails */
    #fileInput{position:absolute;left:-9999px;width:1px;height:1px}
  </style>
  <!-- jsPDF -->
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="nav-wrap">
      <a class="brand" href="../index.html">Photo<span class="accent">Compressor</span>Pro</a>
      <nav>
        <a href="../index.html">Home</a>
        <a href="../blog.html">Blog</a>
        <a href="../contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="hero">
        <h1>Image ‚Üí PDF</h1>
        <p>Combine multiple JPG/PNG images into a single PDF. 100% in your browser.</p>
      </div>

      <div class="controls">
        <button id="pickBtn" class="btn secondary">üìÅ Choose Images</button>
        <input id="fileInput" type="file" accept="image/*" multiple>

        <label>Page:
          <select id="pageSize">
            <option value="a4|p" selected>A4 Portrait</option>
            <option value="a4|l">A4 Landscape</option>
            <option value="letter|p">Letter Portrait</option>
            <option value="letter|l">Letter Landscape</option>
          </select>
        </label>

        <label>Margin (mm):
          <input id="margin" type="number" min="0" max="40" value="10">
        </label>

        <label>Fit:
          <select id="fitMode">
            <option value="contain" selected>Contain (no crop)</option>
            <option value="cover">Cover (fill page)</option>
            <option value="width">Fit width</option>
            <option value="height">Fit height</option>
          </select>
        </label>

        <button id="makePdf" class="btn">Create PDF</button>
      </div>

      <div id="preview" class="preview"></div>
    </section>
  </main>

  <footer style="text-align:center;color:#6b7280;margin:30px 0 24px;font-size:.9rem">
    ¬© 2025 PhotoCompressorPro.com ‚Ä¢ <a href="../privacy.html">Privacy</a> ‚Ä¢ <a href="../about.html">About</a> ‚Ä¢ <a href="../contact.html">Contact</a>
  </footer>

  <script>
    <script>
  const $ = s=>document.querySelector(s);
  const pickBtn   = $('#pickBtn');
  const fileInput = $('#fileInput');
  const pageSizeEl= $('#pageSize');
  const marginEl  = $('#margin');
  const fitEl     = $('#fitMode');
  const preview   = $('#preview');
  const btn       = $('#makePdf');

  // Open system picker (works on iOS/Android/desktop)
  pickBtn?.addEventListener('click', ()=> fileInput.click());

  // Small preview of selected images
  function showPreview(files){
    preview.innerHTML = '';
    [...files].forEach(f=>{
      const url = URL.createObjectURL(f);
      const div = document.createElement('div');
      div.className = 'thumb';
      div.innerHTML = `<img src="${url}" alt=""><div class="meta">${f.name}</div>`;
      preview.appendChild(div);
    });
  }
  fileInput?.addEventListener('change', ()=> showPreview(fileInput.files));

  // Fit/cover math
  function calcPlacement(imgW, imgH, pageW, pageH, margin, mode){
    const w = pageW - margin*2, h = pageH - margin*2;
    const rImg = imgW / imgH, rBox = w / h;
    let outW, outH;
    if (mode === 'width'){ outW = w; outH = outW / rImg; }
    else if (mode === 'height'){ outH = h; outW = outH * rImg; }
    else if (mode === 'cover'){
      if (rImg > rBox){ outH = h; outW = outH * rImg; }
      else { outW = w; outH = outW / rImg; }
    } else { // contain
      if (rImg > rBox){ outW = w; outH = outW / rImg; }
      else { outH = h; outW = outH * rImg; }
    }
    const x = margin + (w - outW)/2;
    const y = margin + (h - outH)/2;
    return {x,y,w:outW,h:outH};
  }

  // iOS-safe: read files as DataURL
  const readAsDataURL = f => new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = e => res(e.target.result);
    r.onerror = rej;
    r.readAsDataURL(f);
  });

  // iOS-safe: save blob with fallback
  function savePdfBlob(doc, filename='images.pdf'){
    const blob = doc.output('blob');                  // create Blob in memory
    const url  = URL.createObjectURL(blob);           // object URL (works better than datauri on iOS)
    const a    = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();

    // If iOS ignores download attribute, open new tab as fallback
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    setTimeout(()=>{
      if (isIOS) {
        try { window.open(url, '_blank'); } catch(_){}
      }
      // Revoke after a short delay to allow Safari to access it
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1500);
    }, 0);
  }

  btn?.addEventListener('click', async ()=>{
    const files = [...(fileInput?.files||[])];
    if (!files.length){ alert('Please choose at least one image.'); return; }
    btn.disabled = true; btn.textContent = 'Building‚Ä¶';

    const [{ jsPDF }] = [window.jspdf || {}];
    if (!jsPDF){ alert('Failed to load PDF library.'); btn.disabled=false; btn.textContent='Create PDF'; return; }

    const [size, orient] = pageSizeEl.value.split('|');
    const doc = new jsPDF({
      format: size,
      orientation: (orient==='p'?'portrait':'landscape'),
      unit: 'mm',
      compress: true
    });

    const pageW = doc.internal.pageSize.getWidth();
    const pageH = doc.internal.pageSize.getHeight();
    const margin = parseInt(marginEl.value,10) || 10;
    const mode = fitEl.value;

    for (let i=0;i<files.length;i++){
      const f = files[i];
      // Read file ‚Üí DataURL (iOS friendly)
      const dataURL = await readAsDataURL(f);
      const img = new Image();
      await new Promise((res, rej)=>{ img.onload=()=>res(); img.onerror=rej; img.src=dataURL; });

      const {x,y,w,h} = calcPlacement(
        img.naturalWidth||img.width,
        img.naturalHeight||img.height,
        pageW, pageH, margin, mode
      );

      if (i>0) doc.addPage();
      const fmt = (/\.(png)$/i.test(f.name) || (f.type||'').includes('png')) ? 'PNG' : 'JPEG';
      doc.addImage(dataURL, fmt, x, y, w, h, undefined, 'FAST');
    }

    // iOS-safe save
    savePdfBlob(doc, 'images.pdf');
    btn.disabled = false; btn.textContent = 'Create PDF';
  });
</script>
  </script>
</body>
</html>
